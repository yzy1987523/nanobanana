---
name: 批量生图工具
overview: 创建 Python 批量生图工具，读取 JSON 提示词列表，调用魔塔 API 依次生成图片并保存到指定路径，使用 name 字段命名文件。
todos:
  - id: create-requirements
    content: 创建 requirements.txt 依赖文件
    status: completed
  - id: create-prompts
    content: 创建示例 prompts.json 提示词文件
    status: completed
  - id: create-script
    content: 实现 generate_images.py 主脚本
    status: completed
    dependencies:
      - create-requirements
      - create-prompts
---

## 产品概述

一个批量图片生成工具，根据提示词列表使用魔塔 API 依次生成图片并保存到本地

## 核心功能

- 读取 JSON 格式的提示词列表
- 使用魔塔 API 异步生成图片
- 自动轮询等待生成完成
- 下载图片并按 name 字段命名保存到指定目录

## 技术栈

- 语言：Python 3.x
- HTTP 请求：requests 库
- API：魔塔 ModelScope 图像生成 API
- 模型：AI-ModelScope/sdxl-v1-0

## 实现方案

采用命令行脚本形式，用户通过参数指定提示词文件和输出目录。

### 核心流程

```
读取 prompts.json → 遍历提示词 → 提交异步任务 → 轮询状态 → 下载保存
```

### API 调用机制

魔塔图片生成 API 采用异步模式：

1. POST `/images/generations` 提交任务，获取 `task_id`
2. GET `/tasks/{task_id}` 轮询状态，等待 `SUCCEED`
3. 从返回结果中提取图片 URL 并下载

## 目录结构

```
nanobanana/
├── generate_images.py    # [NEW] 主脚本，包含 API 调用、轮询、下载逻辑
├── prompts.json          # [NEW] 示例提示词文件
├── requirements.txt      # [NEW] 依赖声明
└── output/               # [NEW] 图片输出目录（自动创建）
```

## 关键代码结构

```python
# 提示词数据结构
@dataclass
class PromptItem:
    name: str      # 文件命名
    prompt: str    # 图片描述

# API 响应结构
class TaskResult:
    task_id: str
    status: str     # PENDING/RUNNING/SUCCEED/FAILED
    image_url: str  # 生成成功后的图片URL
```